"use strict";(self.webpackChunksales_frontend=self.webpackChunksales_frontend||[]).push([[675],{4675:(p,u,o)=>{o.r(u),o.d(u,{ConfiguracionComponent:()=>E});var c=o(177),a=o(9417),r=o(4438),d=o(4430),f=o(3868),h=o(7473);function m(t,n){1&t&&(r.j41(0,"div"),r.EFF(1,"Cargando sucursales..."),r.k0s())}function g(t,n){if(1&t&&(r.j41(0,"tr")(1,"td"),r.EFF(2),r.k0s(),r.j41(3,"td"),r.EFF(4),r.k0s(),r.j41(5,"td"),r.EFF(6),r.k0s()()),2&t){const s=n.$implicit;r.R7$(2),r.JRh(s.nombre),r.R7$(2),r.JRh(s.direccion),r.R7$(2),r.JRh(s.telefono)}}function _(t,n){if(1&t&&(r.j41(0,"table",5)(1,"thead")(2,"tr")(3,"th"),r.EFF(4,"Nombre"),r.k0s(),r.j41(5,"th"),r.EFF(6,"Direcci\xf3n"),r.k0s(),r.j41(7,"th"),r.EFF(8,"Tel\xe9fono"),r.k0s()()(),r.j41(9,"tbody"),r.DNE(10,g,7,3,"tr",6),r.k0s()()),2&t){const s=r.XpG();r.R7$(10),r.Y8G("ngForOf",s.sucursales)}}function b(t,n){1&t&&(r.j41(0,"div",7),r.EFF(1,"No hay sucursales cargadas."),r.k0s())}function F(t,n){if(1&t){const s=r.RV6();r.j41(0,"div",8)(1,"div",9)(2,"form",10),r.bIt("ngSubmit",function(){r.eBV(s);const e=r.XpG();return r.Njj(e.guardarSucursal())}),r.j41(3,"div",11)(4,"label"),r.EFF(5,"Nombre"),r.k0s(),r.nrm(6,"input",12),r.k0s(),r.j41(7,"div",11)(8,"label"),r.EFF(9,"Direcci\xf3n"),r.k0s(),r.nrm(10,"input",13),r.k0s(),r.j41(11,"div",11)(12,"label"),r.EFF(13,"Tel\xe9fono"),r.k0s(),r.nrm(14,"input",14),r.k0s(),r.j41(15,"button",15),r.EFF(16),r.k0s(),r.j41(17,"button",16),r.bIt("click",function(){r.eBV(s);const e=r.XpG();return r.Njj(e.cerrarSucursalForm())}),r.EFF(18,"Cancelar"),r.k0s()()()()}if(2&t){const s=r.XpG();r.R7$(2),r.Y8G("formGroup",s.sucursalForm),r.R7$(13),r.Y8G("disabled",s.sucursalForm.invalid),r.R7$(),r.JRh(s.editSucursalMode?"Actualizar":"Crear")}}let E=(()=>{class t{constructor(s,i,e,l){this.fb=s,this.categoriasService=i,this.sucursalesService=e,this.notification=l,this.categorias=[],this.loading=!1,this.showForm=!1,this.editMode=!1,this.categoriaEditando=null,this.sucursales=[],this.loadingSucursales=!1,this.showSucursalForm=!1,this.sucursalForm=this.fb.group({nombre:[""],direccion:[""],telefono:[""]}),this.editSucursalMode=!1,this.sucursalEditando=null,this.form=this.fb.group({nombre:["",[a.k0.required,a.k0.maxLength(40)]],descripcion:[""]})}ngOnInit(){this.cargarCategorias(),this.cargarSucursales()}cargarCategorias(){this.loading=!0,this.categoriasService.getAll().subscribe({next:s=>{this.categorias=s,this.loading=!1},error:()=>{this.notification.error("Error","No se pudieron cargar las categor\xedas"),this.loading=!1}})}cargarSucursales(){this.loadingSucursales=!0,this.sucursalesService.getAll().subscribe({next:s=>{this.sucursales=s,this.loadingSucursales=!1},error:()=>{this.notification.error("Error","No se pudieron cargar las sucursales"),this.loadingSucursales=!1}})}abrirForm(s,i){this.showForm=!0,this.editMode=!s,s?(this.form.reset(),this.categoriaEditando=null):i&&(this.form.patchValue({nombre:i.nombre,descripcion:i.descripcion||""}),this.categoriaEditando=i)}abrirSucursalForm(s,i){this.showSucursalForm=!0,this.editSucursalMode=!s,s?(this.sucursalForm.reset(),this.sucursalEditando=null):i&&(this.sucursalForm.patchValue({nombre:i.nombre,direccion:i.direccion||"",telefono:i.telefono||""}),this.sucursalEditando=i)}cerrarForm(){this.showForm=!1,this.form.reset(),this.categoriaEditando=null}cerrarSucursalForm(){this.showSucursalForm=!1,this.sucursalForm.reset(),this.sucursalEditando=null}guardarCategoria(){if(this.form.invalid)return;const s=this.form.value;this.editMode&&this.categoriaEditando?this.categoriasService.update(this.categoriaEditando._id,s).subscribe({next:()=>{this.notification.success("Actualizada","Categor\xeda actualizada"),this.cargarCategorias(),this.cerrarForm()},error:()=>this.notification.error("Error","No se pudo actualizar")}):this.categoriasService.create(s).subscribe({next:()=>{this.notification.success("Creada","Categor\xeda creada"),this.cargarCategorias(),this.cerrarForm()},error:()=>this.notification.error("Error","No se pudo crear")})}guardarSucursal(){if(this.sucursalForm.invalid)return;const s=this.sucursalForm.value;this.sucursalesService.create({nombre:s.nombre||"",direccion:s.direccion||"",telefono:s.telefono||""}).subscribe({next:()=>{this.notification.success("Creada","Sucursal creada"),this.cargarSucursales(),this.cerrarSucursalForm()},error:()=>this.notification.error("Error","No se pudo crear la sucursal")})}eliminarCategoria(s){confirm("\xbfEliminar esta categor\xeda?")&&this.categoriasService.delete(s._id).subscribe({next:()=>{this.notification.success("Eliminada","Categor\xeda eliminada"),this.cargarCategorias()},error:()=>this.notification.error("Error","No se pudo eliminar")})}static{this.\u0275fac=function(i){return new(i||t)(r.rXU(a.ok),r.rXU(d.W),r.rXU(f.q),r.rXU(h.J))}}static{this.\u0275cmp=r.VBU({type:t,selectors:[["app-configuracion"]],standalone:!0,features:[r.aNF],decls:8,vars:4,consts:[[1,"btn","btn-primary","mb-2",3,"click"],[4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","card mt-3",4,"ngIf"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"alert","alert-info"],[1,"card","mt-3"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-2"],["formControlName","nombre",1,"form-control"],["formControlName","direccion",1,"form-control"],["formControlName","telefono",1,"form-control"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(i,e){1&i&&(r.j41(0,"h2"),r.EFF(1,"Sucursales"),r.k0s(),r.j41(2,"button",0),r.bIt("click",function(){return e.abrirSucursalForm(!0)}),r.EFF(3,"Nueva sucursal"),r.k0s(),r.DNE(4,m,2,0,"div",1)(5,_,11,1,"table",2)(6,b,2,0,"div",3)(7,F,19,3,"div",4)),2&i&&(r.R7$(4),r.Y8G("ngIf",e.loadingSucursales),r.R7$(),r.Y8G("ngIf",!e.loadingSucursales&&e.sucursales.length),r.R7$(),r.Y8G("ngIf",!e.loadingSucursales&&!e.sucursales.length),r.R7$(),r.Y8G("ngIf",e.showSucursalForm))},dependencies:[c.MD,c.Sq,c.bT,a.X1,a.qT,a.me,a.BC,a.cb,a.j4,a.JD]})}}return t})()}}]);