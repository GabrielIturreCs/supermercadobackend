"use strict";(self.webpackChunksales_frontend=self.webpackChunksales_frontend||[]).push([[581],{7581:(_,c,a)=>{a.r(c),a.d(c,{UsuariosComponent:()=>j});var l=a(177),i=a(9417),r=a(4438),d=a(3366);let m=(()=>{class o{constructor(t){this.api=t}getAll(){return this.api.get("/usuarios")}create(t){return this.api.post("/usuarios",t)}update(t,s){return this.api.put(`/usuarios/${t}`,s)}delete(t){return this.api.delete(`/usuarios/${t}`)}static{this.\u0275fac=function(s){return new(s||o)(r.KVO(d.G))}}static{this.\u0275prov=r.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var f=a(3868),p=a(7473);function h(o,n){1&o&&(r.j41(0,"div"),r.EFF(1,"Cargando usuarios..."),r.k0s())}function F(o,n){if(1&o){const t=r.RV6();r.j41(0,"tr")(1,"td"),r.EFF(2),r.k0s(),r.j41(3,"td"),r.EFF(4),r.k0s(),r.j41(5,"td"),r.EFF(6),r.k0s(),r.j41(7,"td"),r.EFF(8),r.k0s(),r.j41(9,"td"),r.EFF(10),r.k0s(),r.j41(11,"td")(12,"button",7),r.bIt("click",function(){const e=r.eBV(t).$implicit,u=r.XpG(2);return r.Njj(u.abrirForm(!1,e))}),r.EFF(13,"Editar"),r.k0s(),r.j41(14,"button",8),r.bIt("click",function(){const e=r.eBV(t).$implicit,u=r.XpG(2);return r.Njj(u.eliminarUsuario(e))}),r.EFF(15,"Eliminar"),r.k0s()()()}if(2&o){const t=n.$implicit;r.R7$(2),r.JRh(t.username),r.R7$(2),r.JRh(t.email),r.R7$(2),r.JRh(t.role),r.R7$(2),r.JRh(t.activo?"S\xed":"No"),r.R7$(2),r.JRh(t.sucursal||"-")}}function b(o,n){if(1&o&&(r.j41(0,"table",5)(1,"thead")(2,"tr")(3,"th"),r.EFF(4,"Usuario"),r.k0s(),r.j41(5,"th"),r.EFF(6,"Email"),r.k0s(),r.j41(7,"th"),r.EFF(8,"Rol"),r.k0s(),r.j41(9,"th"),r.EFF(10,"Activo"),r.k0s(),r.j41(11,"th"),r.EFF(12,"Sucursal"),r.k0s(),r.j41(13,"th"),r.EFF(14,"Acciones"),r.k0s()()(),r.j41(15,"tbody"),r.DNE(16,F,16,5,"tr",6),r.k0s()()),2&o){const t=r.XpG();r.R7$(16),r.Y8G("ngForOf",t.usuarios)}}function v(o,n){1&o&&(r.j41(0,"div",9),r.EFF(1,"No hay usuarios cargados."),r.k0s())}function k(o,n){if(1&o&&(r.j41(0,"option",33),r.EFF(1),r.k0s()),2&o){const t=n.$implicit;r.Y8G("value",t._id),r.R7$(),r.JRh(t.nombre)}}function g(o,n){1&o&&(r.j41(0,"div",13)(1,"div",14)(2,"label"),r.EFF(3,"Contrase\xf1a"),r.k0s(),r.nrm(4,"input",34),r.k0s()())}function E(o,n){if(1&o){const t=r.RV6();r.j41(0,"div",10)(1,"div",11)(2,"form",12),r.bIt("ngSubmit",function(){r.eBV(t);const e=r.XpG();return r.Njj(e.guardarUsuario())}),r.j41(3,"div",13)(4,"div",14)(5,"label"),r.EFF(6,"Usuario"),r.k0s(),r.nrm(7,"input",15),r.k0s(),r.j41(8,"div",14)(9,"label"),r.EFF(10,"Email"),r.k0s(),r.nrm(11,"input",16),r.k0s(),r.j41(12,"div",14)(13,"label"),r.EFF(14,"Rol"),r.k0s(),r.j41(15,"select",17)(16,"option",18),r.EFF(17,"Admin"),r.k0s(),r.j41(18,"option",19),r.EFF(19,"Gerente"),r.k0s(),r.j41(20,"option",20),r.EFF(21,"Cajero"),r.k0s(),r.j41(22,"option",21),r.EFF(23,"Reponedor"),r.k0s()()()(),r.j41(24,"div",13)(25,"div",14)(26,"label"),r.EFF(27,"Nombre"),r.k0s(),r.nrm(28,"input",22),r.k0s(),r.j41(29,"div",14)(30,"label"),r.EFF(31,"Apellido"),r.k0s(),r.nrm(32,"input",23),r.k0s(),r.j41(33,"div",14)(34,"label"),r.EFF(35,"Sucursal"),r.k0s(),r.j41(36,"select",24)(37,"option",25),r.EFF(38,"Seleccione una sucursal"),r.k0s(),r.DNE(39,k,2,2,"option",26),r.k0s()()(),r.DNE(40,g,5,0,"div",27),r.j41(41,"div",28),r.nrm(42,"input",29),r.j41(43,"label",30),r.EFF(44,"Activo"),r.k0s()(),r.j41(45,"button",31),r.EFF(46),r.k0s(),r.j41(47,"button",32),r.bIt("click",function(){r.eBV(t);const e=r.XpG();return r.Njj(e.cerrarForm())}),r.EFF(48,"Cancelar"),r.k0s()()()()}if(2&o){const t=r.XpG();r.R7$(2),r.Y8G("formGroup",t.form),r.R7$(37),r.Y8G("ngForOf",t.sucursales),r.R7$(),r.Y8G("ngIf",!t.editMode),r.R7$(5),r.Y8G("disabled",t.form.invalid),r.R7$(),r.JRh(t.editMode?"Actualizar":"Crear")}}let j=(()=>{class o{constructor(t,s,e,u){this.usuariosService=t,this.sucursalesService=s,this.fb=e,this.notification=u,this.usuarios=[],this.loading=!1,this.showForm=!1,this.editMode=!1,this.usuarioEditando=null,this.sucursales=[],this.form=this.fb.group({username:["",[i.k0.required,i.k0.maxLength(30)]],email:["",[i.k0.required,i.k0.email]],password:["",[]],role:["cajero",i.k0.required],activo:[!0],nombre:["",i.k0.required],apellido:["",i.k0.required],sucursal:[""]})}ngOnInit(){this.cargarUsuarios(),this.sucursalesService.getAll().subscribe({next:t=>this.sucursales=t,error:()=>this.notification.error("Error","No se pudieron cargar las sucursales")})}cargarUsuarios(){this.loading=!0,this.usuariosService.getAll().subscribe({next:t=>{this.usuarios=t,this.loading=!1},error:()=>{this.notification.error("Error","No se pudieron cargar los usuarios"),this.loading=!1}})}abrirForm(t,s){this.showForm=!0,this.editMode=!t,t?(this.form.reset({role:"cajero",activo:!0}),this.form.get("password")?.setValidators([i.k0.required,i.k0.minLength(6)]),this.form.get("password")?.updateValueAndValidity(),this.usuarioEditando=null):s&&(this.form.patchValue({username:s.username,email:s.email,role:s.role,activo:s.activo,nombre:s.nombre||"",apellido:s.apellido||"",sucursal:s.sucursal||"",password:""}),this.form.get("password")?.clearValidators(),this.form.get("password")?.updateValueAndValidity(),this.usuarioEditando=s),this.form.get("role")?.valueChanges.subscribe(e=>{"admin"!==e?this.form.get("sucursal")?.setValidators([i.k0.required]):this.form.get("sucursal")?.clearValidators(),this.form.get("sucursal")?.updateValueAndValidity()})}cerrarForm(){this.showForm=!1,this.form.reset(),this.usuarioEditando=null}guardarUsuario(){if(this.form.invalid)return;const t=this.form.value;if(this.editMode&&this.usuarioEditando){const s={...t};s.password||delete s.password,this.usuariosService.update(this.usuarioEditando._id,s).subscribe({next:()=>{this.notification.success("Actualizado","Usuario actualizado"),this.cargarUsuarios(),this.cerrarForm()},error:()=>this.notification.error("Error","No se pudo actualizar")})}else this.usuariosService.create(t).subscribe({next:()=>{this.notification.success("Creado","Usuario creado"),this.cargarUsuarios(),this.cerrarForm()},error:()=>this.notification.error("Error","No se pudo crear")})}eliminarUsuario(t){confirm("\xbfEliminar este usuario?")&&this.usuariosService.delete(t._id).subscribe({next:()=>{this.notification.success("Eliminado","Usuario eliminado"),this.cargarUsuarios()},error:()=>this.notification.error("Error","No se pudo eliminar")})}static{this.\u0275fac=function(s){return new(s||o)(r.rXU(m),r.rXU(f.q),r.rXU(i.ok),r.rXU(p.J))}}static{this.\u0275cmp=r.VBU({type:o,selectors:[["app-usuarios"]],standalone:!0,features:[r.aNF],decls:8,vars:4,consts:[[1,"btn","btn-primary","mb-2",3,"click"],[4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","card mt-3",4,"ngIf"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"alert","alert-info"],[1,"card","mt-3"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-4","mb-2"],["formControlName","username",1,"form-control"],["formControlName","email",1,"form-control"],["formControlName","role",1,"form-control"],["value","admin"],["value","gerente"],["value","cajero"],["value","reponedor"],["formControlName","nombre",1,"form-control"],["formControlName","apellido",1,"form-control"],["formControlName","sucursal",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[1,"form-check","mb-2"],["type","checkbox","formControlName","activo","id","activoCheck",1,"form-check-input"],["for","activoCheck",1,"form-check-label"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],["formControlName","password","type","password","autocomplete","new-password",1,"form-control"]],template:function(s,e){1&s&&(r.j41(0,"h2"),r.EFF(1,"Usuarios"),r.k0s(),r.j41(2,"button",0),r.bIt("click",function(){return e.abrirForm(!0)}),r.EFF(3,"Nuevo usuario"),r.k0s(),r.DNE(4,h,2,0,"div",1)(5,b,17,1,"table",2)(6,v,2,0,"div",3)(7,E,49,5,"div",4)),2&s&&(r.R7$(4),r.Y8G("ngIf",e.loading),r.R7$(),r.Y8G("ngIf",!e.loading&&e.usuarios.length),r.R7$(),r.Y8G("ngIf",!e.loading&&!e.usuarios.length),r.R7$(),r.Y8G("ngIf",e.showForm))},dependencies:[l.MD,l.Sq,l.bT,i.X1,i.qT,i.xH,i.y7,i.me,i.Zm,i.wz,i.BC,i.cb,i.j4,i.JD]})}}return o})()}}]);