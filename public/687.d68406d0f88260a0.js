"use strict";(self.webpackChunksales_frontend=self.webpackChunksales_frontend||[]).push([[687],{2068:($,f,s)=>{s.r(f),s.d(f,{StockComponent:()=>y});var d=s(177),c=s(9417),t=s(4438),p=s(2727),_=s(7473);const m=(o,a)=>({"table-danger":o,"table-warning":a});function u(o,a){if(1&o&&(t.j41(0,"span",17),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(n.advertencias.length)}}function g(o,a){1&o&&(t.j41(0,"span",24),t.EFF(1,"event_busy"),t.k0s())}function b(o,a){1&o&&(t.j41(0,"span",24),t.EFF(1,"warning"),t.k0s())}function k(o,a){if(1&o&&(t.j41(0,"li"),t.DNE(1,g,2,0,"span",23)(2,b,2,0,"span",23),t.EFF(3),t.k0s()),2&o){const n=a.$implicit;t.R7$(),t.Y8G("ngIf",n.includes("caducar")),t.R7$(),t.Y8G("ngIf",n.includes("Stock bajo")),t.R7$(),t.SpI(" ",n," ")}}function h(o,a){if(1&o&&(t.j41(0,"ul"),t.DNE(1,k,4,3,"li",22),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",n.advertencias)}}function F(o,a){1&o&&(t.j41(0,"div",25),t.EFF(1,"No hay notificaciones"),t.k0s())}function x(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",18)(1,"div",19)(2,"span",4),t.EFF(3,"notifications"),t.k0s(),t.j41(4,"b"),t.EFF(5,"Notificaciones"),t.k0s(),t.j41(6,"span",20),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.toggleNotificaciones())}),t.EFF(7,"\xd7"),t.k0s()(),t.DNE(8,h,2,1,"ul",21)(9,F,2,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&o){const n=t.sdS(10),e=t.XpG();t.R7$(8),t.Y8G("ngIf",e.advertencias.length)("ngIfElse",n)}}function C(o,a){1&o&&(t.j41(0,"div"),t.EFF(1,"Cargando stock..."),t.k0s())}function E(o,a){1&o&&(t.j41(0,"span",33),t.EFF(1,"warning"),t.k0s())}function v(o,a){1&o&&(t.j41(0,"span",34),t.EFF(1,"event_busy"),t.k0s())}function j(o,a){if(1&o&&(t.qex(0),t.EFF(1),t.nI1(2,"date"),t.bVm()),2&o){const n=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,n.caducidad,"dd/MM/yyyy")," ")}}function M(o,a){if(1&o&&(t.qex(0),t.EFF(1),t.nI1(2,"date"),t.bVm()),2&o){const n=t.XpG(2).$implicit;t.R7$(),t.JRh(t.i5U(2,1,n.vencimiento,"dd/MM/yyyy"))}}function P(o,a){1&o&&(t.qex(0),t.EFF(1,"-"),t.bVm())}function S(o,a){if(1&o&&t.DNE(0,M,3,4,"ng-container",13)(1,P,2,0,"ng-container",13),2&o){const n=t.XpG().$implicit;t.Y8G("ngIf",n.vencimiento),t.R7$(),t.Y8G("ngIf",!n.vencimiento)}}function O(o,a){if(1&o){const n=t.RV6();t.j41(0,"tr",28)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"span",29),t.EFF(5),t.k0s(),t.DNE(6,E,2,0,"span",30)(7,v,2,0,"span",31),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s(),t.j41(14,"td"),t.DNE(15,j,3,4,"ng-container",21)(16,S,2,2,"ng-template",null,1,t.C5r),t.k0s(),t.j41(18,"td")(19,"button",32),t.bIt("click",function(){const i=t.eBV(n).$implicit,r=t.XpG(2);return t.Njj(r.abrirForm(i))}),t.EFF(20,"Editar stock"),t.k0s()()()}if(2&o){const n=a.$implicit,e=t.sdS(17),i=t.XpG(2);t.Y8G("ngClass",t.l_i(11,m,i.isStockBajo(n),i.isCaducidadCercana(n))),t.R7$(2),t.JRh(n.codigo),t.R7$(2),t.Y8G("title",n.descripcion||"Sin descripci\xf3n"),t.R7$(),t.JRh(n.nombre),t.R7$(),t.Y8G("ngIf",i.isStockBajo(n)),t.R7$(),t.Y8G("ngIf",i.isCaducidadCercana(n)),t.R7$(2),t.JRh(n.stock.actual),t.R7$(2),t.JRh(n.stock.minimo),t.R7$(2),t.JRh(n.stock.unidad),t.R7$(2),t.Y8G("ngIf",n.caducidad)("ngIfElse",e)}}function I(o,a){if(1&o&&(t.j41(0,"table",26)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"C\xf3digo"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Nombre"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Stock actual"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Stock m\xednimo"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Unidad"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Caducidad"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Acciones"),t.k0s()()(),t.j41(17,"tbody"),t.DNE(18,O,21,14,"tr",27),t.k0s()()),2&o){const n=t.XpG();t.R7$(18),t.Y8G("ngForOf",n.productosFiltrados)}}function R(o,a){1&o&&(t.j41(0,"div",35),t.EFF(1,"No hay productos que coincidan con la b\xfasqueda."),t.k0s())}function w(o,a){if(1&o){const n=t.RV6();t.j41(0,"div",36)(1,"div",37)(2,"h4"),t.EFF(3),t.k0s(),t.j41(4,"form",38),t.bIt("ngSubmit",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.guardarStock())}),t.j41(5,"div",39)(6,"div",40)(7,"label"),t.EFF(8,"Stock actual"),t.k0s(),t.nrm(9,"input",41),t.k0s(),t.j41(10,"div",40)(11,"label"),t.EFF(12,"Stock m\xednimo"),t.k0s(),t.nrm(13,"input",42),t.k0s(),t.j41(14,"div",40)(15,"label"),t.EFF(16,"Unidad"),t.k0s(),t.j41(17,"select",43)(18,"option",44),t.EFF(19,"Unidades"),t.k0s(),t.j41(20,"option",45),t.EFF(21,"Kg"),t.k0s(),t.j41(22,"option",46),t.EFF(23,"Litros"),t.k0s()()(),t.j41(24,"div",40)(25,"label"),t.EFF(26,"Caducidad"),t.k0s(),t.nrm(27,"input",47),t.k0s()(),t.j41(28,"div",48)(29,"button",49),t.EFF(30,"Actualizar"),t.k0s(),t.j41(31,"button",50),t.bIt("click",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.cerrarForm())}),t.EFF(32,"Cancelar"),t.k0s()()()()()}if(2&o){const n=t.XpG();t.R7$(3),t.SpI("Editar stock de ",null==n.productoEditando?null:n.productoEditando.nombre,""),t.R7$(),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("formGroup",n.form),t.R7$(24),t.Y8G("disabled",n.form.invalid)}}let y=(()=>{class o{constructor(n,e,i){this.productosService=n,this.fb=e,this.notification=i,this.filtroBusqueda="",this.productos=[],this.loading=!1,this.showForm=!1,this.productoEditando=null,this.advertencias=[],this.mostrarNotificaciones=!1,this.filtro="todos",this.form=this.fb.group({actual:[0,[c.k0.required,c.k0.min(0)]],minimo:[0,[c.k0.required,c.k0.min(0)]],unidad:["unidades",c.k0.required]})}ngOnInit(){this.loading=!0,this.productosService.productos$.subscribe({next:n=>{this.productos=n,this.loading=!1,this.generarAdvertencias()},error:()=>{this.notification.error("Error","No se pudo cargar el stock"),this.loading=!1}})}generarAdvertencias(){this.advertencias=[];const n=new Date;for(const e of this.productos)if(e.stock.actual<=e.stock.minimo&&this.advertencias.push(`Stock bajo: ${e.nombre} (${e.stock.actual} unidades)`),e.caducidad){const i=new Date(e.caducidad);(i.getTime()-n.getTime())/864e5<=30&&this.advertencias.push(`Pr\xf3ximo a caducar: ${e.nombre} (vence el ${i.toLocaleDateString()})`)}}cargarProductos(){this.loading=!0,this.productosService.getProductos().subscribe({next:n=>{this.productos=n,this.loading=!1},error:()=>{this.notification.error("Error","No se pudo cargar el stock"),this.loading=!1}})}abrirForm(n){this.showForm=!0,this.form.patchValue({actual:n.stock.actual,minimo:n.stock.minimo,unidad:n.stock.unidad,caducidad:n.caducidad||""}),this.productoEditando=n}cerrarForm(){this.showForm=!1,this.form.reset(),this.productoEditando=null}guardarStock(){if(this.form.invalid||!this.productoEditando)return;const{actual:n,minimo:e,unidad:i,caducidad:r}=this.form.value;this.productosService.actualizarProducto(this.productoEditando._id,{stock:{actual:n,minimo:e,unidad:i},caducidad:r||null}).subscribe({next:()=>{this.notification.success("Actualizado","Stock actualizado"),this.cargarProductos(),this.cerrarForm()},error:()=>this.notification.error("Error","No se pudo actualizar el stock")})}isStockBajo(n){return n.stock.actual<=n.stock.minimo}isCaducidadCercana(n){return!!n.caducidad&&(new Date(n.caducidad).getTime()-Date.now())/864e5<=30}get productosFiltrados(){let n=this.productos;if("bajoStock"===this.filtro?n=n.filter(e=>this.isStockBajo(e)):"caducidad"===this.filtro&&(n=n.filter(e=>this.isCaducidadCercana(e))),this.filtroBusqueda&&this.filtroBusqueda.trim()){const e=this.filtroBusqueda.trim().toLowerCase();n=n.filter(i=>i.nombre&&i.nombre.toLowerCase().includes(e)||i.codigo&&i.codigo.toLowerCase().includes(e))}return n}toggleNotificaciones(){this.mostrarNotificaciones=!this.mostrarNotificaciones}setFiltro(n){this.filtro=n}static{this.\u0275fac=function(e){return new(e||o)(t.rXU(p.J),t.rXU(c.ok),t.rXU(_.J))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-stock"]],standalone:!0,features:[t.aNF],decls:27,vars:13,consts:[["sinNotis",""],["venc",""],[1,"noti-bell-container"],["title","Ver notificaciones",1,"noti-bell",3,"click"],[1,"material-icons"],["class","noti-badge",4,"ngIf"],["class","notificaciones-panel moderno",4,"ngIf"],[1,"d-flex","align-items-center","mb-3","gap-2"],[1,"filtros-rapidos"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],["type","text","placeholder","Buscar por nombre o c\xf3digo...",1,"form-control",2,"max-width","320px","margin-left","12px",3,"ngModelChange","ngModel"],[4,"ngIf"],["class","table table-striped table-modern",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],[1,"noti-badge"],[1,"notificaciones-panel","moderno"],[1,"notificaciones-header"],[1,"cerrar-noti",3,"click"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["class","material-icons noti-list-icon",4,"ngIf"],[1,"material-icons","noti-list-icon"],[1,"text-muted"],[1,"table","table-striped","table-modern"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[3,"title"],["class","material-icons text-warning","title","Stock bajo",4,"ngIf"],["class","material-icons text-danger","title","Pr\xf3ximo a caducar",4,"ngIf"],["title","Editar stock",1,"btn","btn-sm","btn-info",3,"click"],["title","Stock bajo",1,"material-icons","text-warning"],["title","Pr\xf3ximo a caducar",1,"material-icons","text-danger"],[1,"alert","alert-info"],[1,"modal-backdrop"],[1,"modal-stock"],[3,"ngSubmit","formGroup"],[1,"row",3,"formGroup"],[1,"col-md-6","mb-2"],["type","number","formControlName","actual",1,"form-control"],["type","number","formControlName","minimo",1,"form-control"],["formControlName","unidad",1,"form-control"],["value","unidades"],["value","kg"],["value","litros"],["type","date","formControlName","caducidad",1,"form-control"],[1,"d-flex","justify-content-end","mt-3"],["type","submit",1,"btn","btn-success","me-2",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,i){1&e&&(t.j41(0,"h2"),t.EFF(1,"Stock "),t.j41(2,"span",2)(3,"span",3),t.bIt("click",function(){return i.toggleNotificaciones()}),t.j41(4,"span",4),t.EFF(5,"notifications"),t.k0s(),t.DNE(6,u,2,1,"span",5),t.k0s()()(),t.DNE(7,x,11,2,"div",6),t.j41(8,"div",7)(9,"div",8)(10,"button",9),t.bIt("click",function(){return i.setFiltro("todos")}),t.j41(11,"span",4),t.EFF(12,"list"),t.k0s(),t.EFF(13," Todos "),t.k0s(),t.j41(14,"button",10),t.bIt("click",function(){return i.setFiltro("bajoStock")}),t.j41(15,"span",4),t.EFF(16,"warning"),t.k0s(),t.EFF(17," Bajo stock "),t.k0s(),t.j41(18,"button",11),t.bIt("click",function(){return i.setFiltro("caducidad")}),t.j41(19,"span",4),t.EFF(20,"event_busy"),t.k0s(),t.EFF(21," Pr\xf3ximos a caducar "),t.k0s()(),t.j41(22,"input",12),t.mxI("ngModelChange",function(l){return t.DH7(i.filtroBusqueda,l)||(i.filtroBusqueda=l),l}),t.k0s()(),t.DNE(23,C,2,0,"div",13)(24,I,19,1,"table",14)(25,R,2,0,"div",15)(26,w,33,4,"div",16)),2&e&&(t.R7$(6),t.Y8G("ngIf",i.advertencias.length),t.R7$(),t.Y8G("ngIf",i.mostrarNotificaciones),t.R7$(3),t.AVh("active","todos"===i.filtro),t.R7$(4),t.AVh("active","bajoStock"===i.filtro),t.R7$(4),t.AVh("active","caducidad"===i.filtro),t.R7$(4),t.R50("ngModel",i.filtroBusqueda),t.R7$(),t.Y8G("ngIf",i.loading),t.R7$(),t.Y8G("ngIf",!i.loading&&i.productosFiltrados.length),t.R7$(),t.Y8G("ngIf",!i.loading&&!i.productosFiltrados.length),t.R7$(),t.Y8G("ngIf",i.showForm))},dependencies:[d.MD,d.YU,d.Sq,d.bT,d.vh,c.X1,c.qT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.j4,c.JD,c.YN,c.vS],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#1e222d73;z-index:4000;display:flex;align-items:center;justify-content:center}.modal-stock[_ngcontent-%COMP%]{background:#fff;border-radius:14px;box-shadow:0 8px 32px #0000002e;padding:32px 28px 24px;min-width:340px;max-width:95vw;width:420px;animation:_ngcontent-%COMP%_fadeInDown .22s}.modal-stock[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:18px;color:#1976d2;font-weight:600}.modal-stock[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#333}.modal-stock[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:6px;border:1px solid #e3e8ee;font-size:1em}.modal-stock[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:110px}.noti-bell-container[_ngcontent-%COMP%]{float:right;position:relative;margin-left:12px}.noti-bell[_ngcontent-%COMP%]{display:inline-block;background:#fff;border-radius:50%;box-shadow:0 2px 8px #00000014;padding:8px;cursor:pointer;transition:box-shadow .2s,background .2s}.noti-bell[_ngcontent-%COMP%]:hover{background:#f0f4ff;box-shadow:0 4px 16px #4f8cff2e}.noti-bell[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.2em;color:#4f8cff;vertical-align:middle}.noti-badge[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;background:#e53935;color:#fff;border-radius:50%;font-size:.9em;padding:2px 7px;font-weight:700;box-shadow:0 1px 4px #00000026}.notificaciones-panel.moderno[_ngcontent-%COMP%]{position:absolute;top:60px;right:20px;width:340px;background:#23272f;color:#fff;border-radius:12px;box-shadow:0 8px 32px #00000040;padding:0 0 12px;z-index:3000;animation:_ngcontent-%COMP%_fadeInDown .25s}.notificaciones-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px 8px;border-bottom:1px solid #333;font-size:1.1em}.notificaciones-header[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{margin-right:8px;color:#4f8cff}.cerrar-noti[_ngcontent-%COMP%]{margin-left:auto;font-size:1.5em;cursor:pointer;color:#fff;opacity:.7;transition:opacity .2s}.cerrar-noti[_ngcontent-%COMP%]:hover{opacity:1}.notificaciones-panel.moderno[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:8px 20px 0;max-height:320px;overflow-y:auto}.notificaciones-panel.moderno[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid #2d323c;font-size:1em}.notificaciones-panel.moderno[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.noti-list-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:1.3em;color:#ffb300;vertical-align:middle}@keyframes _ngcontent-%COMP%_fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}",".table-modern[_ngcontent-%COMP%] {\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 2px 12px rgba(33, 150, 243, 0.08), 0 1.5px 4px rgba(0,0,0,0.04);\n}\n.table-modern[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n  background: #f5f7fa;\n  color: #1976d2;\n  font-weight: 600;\n  border-bottom: 2px solid #e3e8ee;\n}\n.table-modern[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n  background: #f9fbfd;\n  border-radius: 6px;\n  font-size: 15px;\n}\n.table-danger[_ngcontent-%COMP%] {\n  background-color: #fff3cd !important;\n}\n.table-warning[_ngcontent-%COMP%] {\n  background-color: #ffeeba !important;\n}\n.notificaciones-panel[_ngcontent-%COMP%] {\n  position: fixed;\n  top: 30px;\n  right: 30px;\n  width: 340px;\n  background: #fff;\n  border-radius: 12px;\n  box-shadow: 0 4px 24px rgba(33, 150, 243, 0.15);\n  z-index: 2000;\n  padding: 18px 20px 12px 20px;\n  animation: _ngcontent-%COMP%_fadeIn 0.2s;\n}\n.notificaciones-header[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 18px;\n  margin-bottom: 10px;\n}\n.badge.bg-danger[_ngcontent-%COMP%] {\n  background: #e53935;\n  color: #fff;\n  font-size: 12px;\n  padding: 2px 7px;\n  border-radius: 10px;\n}\n.filtros-rapidos[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%] {\n  background: #1976d2;\n  color: #fff;\n  border-color: #1976d2;\n}\n.material-icons.text-warning[_ngcontent-%COMP%] { color: #fbc02d; vertical-align: middle; }\n.material-icons.text-danger[_ngcontent-%COMP%] { color: #e53935; vertical-align: middle; }\n@keyframes _ngcontent-%COMP%_fadeIn { from { opacity: 0; transform: translateY(-10px);} to { opacity: 1; transform: none; } }"]})}}return o})()}}]);