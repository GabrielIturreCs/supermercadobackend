"use strict";(self.webpackChunksales_frontend=self.webpackChunksales_frontend||[]).push([[76],{3366:(D,_,o)=>{o.d(_,{G:()=>v});var d=o(1626),h=o(5312),l=o(4438),u=o(4796);let v=(()=>{class r{constructor(c,t){this.http=c,this.authService=t,this.apiUrl=h.c.apiUrl}getHeaders(){const c=this.authService.getToken();return new d.Lr({"Content-Type":"application/json",Authorization:c?`Bearer ${c}`:""})}get(c){return this.http.get(`${this.apiUrl}${c}`,{headers:this.getHeaders()})}post(c,t){return this.http.post(`${this.apiUrl}${c}`,t,{headers:this.getHeaders()})}put(c,t){return this.http.put(`${this.apiUrl}${c}`,t,{headers:this.getHeaders()})}delete(c){return this.http.delete(`${this.apiUrl}${c}`,{headers:this.getHeaders()})}static{this.\u0275fac=function(t){return new(t||r)(l.KVO(d.Qq),l.KVO(u.u))}}static{this.\u0275prov=l.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})()},4430:(D,_,o)=>{o.d(_,{W:()=>l});var d=o(4438),h=o(3366);let l=(()=>{class u{constructor(r){this.api=r}getAll(){return this.api.get("/categorias")}create(r){return this.api.post("/categorias",r)}update(r,i){return this.api.put(`/categorias/${r}`,i)}delete(r){return this.api.delete(`/categorias/${r}`)}static{this.\u0275fac=function(i){return new(i||u)(d.KVO(h.G))}}static{this.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},1293:(D,_,o)=>{o.d(_,{p:()=>l});var d=o(467),h=o(4438);let l=(()=>{class u{constructor(){this.dbName="SalesSystemDB",this.dbVersion=1,this.db=null,this.initDB()}initDB(){var r=this;return(0,d.A)(function*(){return new Promise((i,c)=>{const t=indexedDB.open(r.dbName,r.dbVersion);t.onerror=()=>c(t.error),t.onsuccess=()=>{r.db=t.result,i()},t.onupgradeneeded=e=>{const n=e.target.result;["productos","ventas","carrito","usuarios","configuracion"].forEach(a=>{n.objectStoreNames.contains(a)||n.createObjectStore(a,{keyPath:"id",autoIncrement:!0})})}})})()}saveToIndexedDB(r,i){var c=this;return(0,d.A)(function*(){return c.db||(yield c.initDB()),new Promise((t,e)=>{const n=c.db.transaction([r],"readwrite"),s=n.objectStore(r);s.clear(),Array.isArray(i)?i.forEach(a=>s.add(a)):s.add(i),n.oncomplete=()=>t(),n.onerror=()=>e(n.error)})})()}getFromIndexedDB(r){var i=this;return(0,d.A)(function*(){return i.db||(yield i.initDB()),new Promise((c,t)=>{const s=i.db.transaction([r],"readonly").objectStore(r).getAll();s.onsuccess=()=>c(s.result),s.onerror=()=>t(s.error)})})()}deleteFromIndexedDB(r,i){var c=this;return(0,d.A)(function*(){return c.db||(yield c.initDB()),new Promise((t,e)=>{const a=c.db.transaction([r],"readwrite").objectStore(r).delete(i);a.onsuccess=()=>t(),a.onerror=()=>e(a.error)})})()}isOnline(){return navigator.onLine}syncWhenOnline(){var r=this;return(0,d.A)(function*(){r.isOnline()&&console.log("Sincronizando datos...")})()}static{this.\u0275fac=function(i){return new(i||u)}}static{this.\u0275prov=h.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},2727:(D,_,o)=>{o.d(_,{J:()=>r});var d=o(4412),h=o(1985),l=o(4438),u=o(3366),v=o(1293);let r=(()=>{class i{constructor(t,e){this.apiService=t,this.offlineService=e,this.productosSubject=new d.t([]),this.productos$=this.productosSubject.asObservable(),this.loadProductos()}loadProductos(){this.apiService.get("/productos").subscribe({next:t=>{this.productosSubject.next(t),this.offlineService.saveToIndexedDB("productos",t)},error:()=>{this.offlineService.getFromIndexedDB("productos").then(t=>{t&&this.productosSubject.next(t)})}})}getProductos(){return this.productos$}getProductoPorCodigo(t){return new h.c(e=>{this.productos$.subscribe(n=>{const s=n.find(a=>a.codigo===t);e.next(s||null)})})}crearProducto(t){return this.apiService.post("/productos",t)}actualizarProducto(t,e){return this.apiService.put(`/productos/${t}`,e)}eliminarProducto(t){return this.apiService.delete(`/productos/${t}`)}actualizarStock(t,e,n){return this.apiService.put(`/productos/${t}/stock`,{cantidad:e,operacion:n})}buscarProductos(t){return new h.c(e=>{this.productos$.subscribe(n=>{const s=n.filter(a=>a.nombre&&a.nombre.toLowerCase().includes(t.toLowerCase())||a.codigo&&a.codigo.toLowerCase().includes(t.toLowerCase())||"string"==typeof a.categoria&&a.categoria.toLowerCase().includes(t.toLowerCase()));e.next(s)})})}getProductosStockBajo(){return new h.c(t=>{this.productos$.subscribe(e=>{const n=e.filter(s=>s.stock.actual<=s.stock.minimo);t.next(n)})})}getProductosPorVencer(t=7){return new h.c(e=>{this.productos$.subscribe(n=>{const s=new Date;s.setDate(s.getDate()+t);const a=n.filter(f=>f.vencimiento&&new Date(f.vencimiento)<=s);e.next(a)})})}static{this.\u0275fac=function(e){return new(e||i)(l.KVO(u.G),l.KVO(v.p))}}static{this.\u0275prov=l.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},3868:(D,_,o)=>{o.d(_,{q:()=>l});var d=o(4438),h=o(3366);let l=(()=>{class u{constructor(r){this.api=r}getAll(){return this.api.get("/sucursales")}create(r){return this.api.post("/sucursales",r)}static{this.\u0275fac=function(i){return new(i||u)(d.KVO(h.G))}}static{this.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},3425:(D,_,o)=>{o.d(_,{$:()=>r});var d=o(4412),h=o(1985),l=o(4438),u=o(3366),v=o(1293);let r=(()=>{class i{constructor(t,e){this.apiService=t,this.offlineService=e,this.ventasSubject=new d.t([]),this.ventas$=this.ventasSubject.asObservable(),this.carritoSubject=new d.t([]),this.carrito$=this.carritoSubject.asObservable(),this.totalDia=0,this.totalMes=0,this.totalAnio=0,this.loadVentas(),this.loadCarrito()}loadVentas(t={}){let e="";t.periodo&&(e+=`periodo=${t.periodo}`),t.desde&&(e+=(e?"&":"")+`desde=${t.desde}`),t.hasta&&(e+=(e?"&":"")+`hasta=${t.hasta}`),this.apiService.get(e?`/ventas?${e}`:"/ventas").subscribe({next:s=>{this.ventasSubject.next(s.ventas),this.totalDia=s.totalDia,this.totalMes=s.totalMes,this.totalAnio=s.totalAnio,this.offlineService.saveToIndexedDB("ventas",s.ventas)},error:()=>{this.offlineService.getFromIndexedDB("ventas").then(s=>{s&&this.ventasSubject.next(s)})}})}loadCarrito(){this.offlineService.getFromIndexedDB("carrito").then(t=>{t&&this.carritoSubject.next(t)})}agregarAlCarrito(t){const e=this.carritoSubject.value,n=e.find(s=>s.codigo===t.codigo&&s.variante===t.variante);n?(n.cantidad+=t.cantidad,n.subtotal=n.cantidad*n.precio):e.push(t),this.carritoSubject.next([...e]),this.offlineService.saveToIndexedDB("carrito",e)}actualizarCantidadCarrito(t,e,n){const s=this.carritoSubject.value,a=s.find(f=>f.codigo===t&&f.variante===n);a&&(a.cantidad=e,a.subtotal=a.cantidad*a.precio,this.carritoSubject.next([...s]),this.offlineService.saveToIndexedDB("carrito",s))}eliminarDelCarrito(t,e){const s=this.carritoSubject.value.filter(a=>!(a.codigo===t&&a.variante===e));this.carritoSubject.next(s),this.offlineService.saveToIndexedDB("carrito",s)}limpiarCarrito(){this.carritoSubject.next([]),this.offlineService.saveToIndexedDB("carrito",[])}calcularTotalCarrito(){return this.carritoSubject.value.reduce((t,e)=>t+e.subtotal,0)}procesarVenta(t){return this.apiService.post("/ventas",t)}getVentas(){return this.ventas$}getVentasPorFecha(t,e){return new h.c(n=>{this.ventas$.subscribe(s=>{const a=s.filter(f=>{const p=new Date(f.fecha);return p>=t&&p<=e});n.next(a)})})}getVentasDelDia(){const t=new Date;t.setHours(0,0,0,0);const e=new Date(t);return e.setDate(e.getDate()+1),this.getVentasPorFecha(t,e)}cancelarVenta(t){return this.apiService.put(`/ventas/${t}/cancelar`,{})}static{this.\u0275fac=function(e){return new(e||i)(l.KVO(u.G),l.KVO(v.p))}}static{this.\u0275prov=l.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},3294:(D,_,o)=>{o.d(_,{F:()=>u});var d=o(3669),h=o(9974),l=o(4360);function u(r,i=d.D){return r=r??v,(0,h.N)((c,t)=>{let e,n=!0;c.subscribe((0,l._)(t,s=>{const a=i(s);(n||!r(e,a))&&(n=!1,e=a,t.next(s))}))})}function v(r,i){return r===i}}}]);